################################################################################
# SCHEMA METADATA
# Here is where we describe the metadata for the schema
################################################################################

id: https://example.org/umces
name: data-sample
title: UMCES Raw Pot Survey Data Schema
description: |
   LinkML schema for marine species survey data shared via Google Drive:
   https://docs.google.com/spreadsheets/d/1yY2hdD4Hoh3hbieIyu9Lsm_nq7sKyC08
license: TBD
prefixes:
  linkml: https://w3id.org/linkml/
  umces: https://example.org/umces/
  dwc: http://rs.tdwg.org/dwc/terms/
  s10: http://vocab.nerc.ac.uk/collection/S10/current/
  P01: http://vocab.nerc.ac.uk/collection/P01/current/
  worms: "urn:lsid:marinespecies.org:taxname:"
default_prefix: umces
imports:
- linkml:types
- linkml:units
################################################################################
# ENUMS - CONTROLLED VOCABULARIES
# Here is where we define the enums (factor levels) that are needed
################################################################################

enums:
  NotRecorded:
    permissible_values:
      NA:
        description: Value was not recorded
        meaning: NCIT:C17998  # "Unknown" or use another appropriate term
        
  CatchNA:
    permissible_values:
      NA:
        description: Pot was empty (zero catch)
        meaning: NCIT:C48660

  TaxonEnum:
    description: Taxa observed in the survey
    permissible_values:
      atl lobster:
        meaning: worms:156134
        description: Homarus americanus
      black sea bass:
        meaning: worms:159348
        description: Centropristis striata
      blue crab:
        meaning: worms:107379
        description: Callinectes sapidus
      butterfish:
        meaning: worms:159828
        description: Peprilus triacanthus
      clam:
        meaning: worms:156996
        description: Spisula solidissima
      conger eel:
        meaning: worms:158566
        description: Conger oceanicus
      hermit crab:
        meaning: worms:366751
        description: Pagurus pollicaris
      jonah crab:
        meaning: worms:158056
        description: Cancer borealis
      lady crab:
        meaning: worms:158434
        description: Ovalipes ocellatus
      leatherjacket:
        meaning: worms:307126
        description: Stephanolepis hispida
      lingcod:
        meaning: worms:158991
        description: Urophycis regia
      moon jelly:
        meaning: worms:135306
        description: Aurelia aurita
      mud crab:
        meaning: worms:158436
        description: Panopeus herbstii
      porgy:
        meaning: worms:159811
        description: Stenotomus chrysops
      rock crab:
        meaning: worms:158057
        description: Cancer irroratus
      sand dollar:
        meaning: worms:158062
        description: Echinarachnius parma
      scallop:
        meaning: worms:156972
        description: Placopecten magellanicus
      scup:
        meaning: worms:159811
        description: Stenotomus chrysops
      seahorse:
        meaning: worms:159445
        description: Hippocampus erectus
      sea robin:
        meaning: worms:159571
        description: Prionotus carolinus
      n searobin:
        meaning: worms:159571
        description: Prionotus carolinus
      sea star:
        meaning: worms:158489
        description: Asterias forbesi
      sea urchin:
        meaning: worms:158058
        description: Arbacia punctulata
      snail:
        meaning: worms:160461
        description: Polinices duplicatus
      spot:
        meaning: worms:159322
        description: Leiostomus xanthurus
      spotted hake:
        meaning: worms:158991
        description: Urophycis regia
      summer flounder:
        meaning: worms:158826
        description: Paralichthys dentatus
      triggerfish:
        meaning: worms:154721
        description: Balistes capriscus
      windowpane:
        meaning: worms:158907
        description: Scophthalmus aquosus
  
  CardinalDirection:
    permissible_values:
      N:
        description: North
      S:
        description: South
      E:
        description: East
      W:
        description: West
      NE:
        description: Northeast
      NW:
        description: Northwest
      SE:
        description: Southeast
      SW:
        description: Southwest
  SexEnum:
    description: "Sex categories from NERC S10 vocabulary (a subset)."
    permissible_values:
      F:
        meaning: s10:S102
        description: "Female"  
      I:
        meaning: s10:S105
        description: "Indeterminate"  
      M:
        meaning: s10:S103
        description: "Male" 

  participantEnum:
    description: Personnel involved in ocean sampling operations
    permissible_values:
      DS:
        description: Dave Secor
        title: Dave Secor
      MOB:
        description: Mike O'Brien
        title: Mike O'Brien
      KS:
        description: Kirsten Silva
        title: Kirsten Silva
      EK:
        description: Evan Kostelecky
        title: Evan Kostelecky
      LR:
        description: Lauren Rodriguez
        title: Lauren Rodriguez
      KH:
        description: Kerry Harrington
        title: Kerry Harrington
      BH:
        description: Brandon Harrington
        title: Brandon Harrington
      Jm:
        description: Jeff (mate)
        title: Jeff (mate)
      Rm:
        description: Reilly (mate)
        title: Reilly (mate)
      Lm:
        description: Lucas (mate)
        title: Lucas (mate)
      Wm:
        description: Will (mate)
        title: Will (mate)
      ENm:
        description: Ethan N (mate)
        title: Ethan N (mate)
      Cm:
        description: Conor (mate)
        title: Conor (mate)
      KB:
        description: KB (mate/captain)
        title: KB (mate/captain)
      RA:
        description: Reece Aponte (VIMS)
        title: Reece Aponte (VIMS)

  DeploymentType:
    description: Type of sampling event - deployment or recovery of gear
    permissible_values:
      deploy:
        description: Deployment of sampling gear
        title: Deploy
      recover:
        description: Recovery of sampling gear
        title: Recover
  
  RetainedEnum:
    description: Whether specimen was retained
    permissible_values:
      Y:
        description: Yes, specimen was retained
        title: Yes
      N:
        description: No, specimen was not retained
        title: No

################################################################################
# CLASSES - DATA TABLES
# Here is where we define the classes, i.e. groupings of slots
################################################################################

classes:
  Station:
    description: Station tab in google sheet
    close_mappings:
    - dwc:Event
    annotations:
      dwc_target_class: Event
      transformation_note: Station records map to Darwin Core Event core as point locations; parent deployment/recovery cruise events have footprintWKT
    slots:
    - datetime
    - station
    - cruise_id
    - type
    - depth
    - wind_speed
    - wind_dir
    - wave_height
    - cloud_cover_10th
    - ropeless_id
    - hobo_id
    - surf_temp_f
    - lon_start
    - lat_start
    - lon_end
    - lat_end
    - notes
    - participants
    - old_station
  CPUE:
    description: CPUE tab in google sheet
    close_mappings:
    - dwc:Occurrence
    annotations:
      dwc_target_class: Occurrence
      transformation_note: CPUE records map to Darwin Core Occurrence extension
    slots:
    - Recover_date
    - station
    - Pot_position
    - Pot_ID
    - Near_Far
    - Species
    - Catch
    - notes
    - old_station
  Measurements:
    description: Measurements tab in google sheets
    close_mappings:
    - dwc:MeasurementOrFact
    annotations:
      dwc_target_class: MeasurementOrFact
      transformation_note: Measurements pivot to long format for MeasurementOrFact extension
    slots:
    - Date
    - station
    - Near_Far
    - Species
    - TL_mm
    - Wt_g_recorded
    - scale_tare_g
    - Wt_g
    - Sex
    - Retained
    - Barotrauma
    - notes
    - old_station

################################################################################
# SLOTS - FIELD DEFINITIONS
# Here is where we describe the column names from MOB data and conceptually
# map them to DwC
################################################################################

slots:
  Barotrauma:
    description: Barotrauma observation
    range: string
    related_mappings:
    - dwc:occurrenceRemarks
    annotations:
      transformation_type: append
      transformation_note: Barotrauma observation should be appended to occurrenceRemarks
    comments:
      - "Barotrauma started being recorded on the 2306 cruise, as some fish with everted stomachs would have false-empty stomachs"

  Catch:
    description: |
      Catch count. Accepts integer values or "NA" (pot was empty).
    any_of:
      - range: integer
      - range: CatchNA
    exact_mappings:
      - dwc:individualCount
    annotations:
      transformation_type: direct
      transformation_note: Catch count maps directly to individualCount

  Date:
    description: Date of animal measurements
    range: datetime
    pattern: ^\d{4}-\d{2}-\d{2}
    exact_mappings:
    - dwc:eventDate
    annotations:
      transformation_type: direct
      transformation_note: Measurement date - used to link to parent Event
    alias:
      - Date
    comments:
      - Must be ISO-8601 formatted, like YYYY-mm-DD

  Near_Far:
    description: |
      Position relative to reference point (near/far). If station begins with C then it's a control for an area. If station doesn't begin with C it's the name of a proposed structure. Coordinates for the structure (and threfore reference point) are available through the BOEM Constructions and Operations (COP) Plan: https://www.boem.gov/sites/default/files/documents/renewable-energy/state-activities/App-I-F-WTG-OSS-Locations.pdf 
    range: string
    related_mappings:
      - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Distance category becomes MeasurementOrFact
    alias:
      - "Near/Far"

  Pot_ID:
    description: Pot/trap identifier
    range: integer
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Pot ID becomes MeasurementOrFact; also used in eventID construction

  Pot_position:
    description: Pot position in string (1-15)
    range: integer
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Pot position becomes MeasurementOrFact linked to Station or Pot eventID

  Recover_date:
    description: Date (recovery of Pot?)
    range: datetime
    pattern: ^\d{4}-\d{2}-\d{2}
    exact_mappings:
    - dwc:eventDate
    annotations:
      transformation_type: direct
      transformation_note: Recovery date maps to eventDate for Occurrence records
    comments:
      - Must be ISO-8601 formatted, like YYYY-mm-DD

  Retained:
    description: Whether specimen was retained
    range: RetainedEnum
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Retained status becomes MeasurementOrFact with measurementType='retained'

  Sex:
    description: Sex of organism
    range: SexEnum
    exact_mappings:
    - dwc:sex
    annotations:
      transformation_type: direct
      transformation_note: Sex maps directly to dwc:sex

  Species:
    description: Species common name
    range: TaxonEnum
    close_mappings:
      - dwc:vernacularName
    related_mappings:
      - dwc:scientificName
      - dwc:scientificNameID
    annotations:
      transformation_type: direct
      transformation_note: Common name maps to vernacularName; scientificName should be looked up from taxonomy

  TL_mm:
    description: Total length in millimeters. The tip of the snout in a straight line to the posterior end of the caudal fin. 
    range: integer
    unit:
      ucum_code: mm
    exact_mappings:
      - P01:TL01XX01
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Pivot to MeasurementOrFact with measurementType='total length', measurementValue=TL_mm, measurementUnit='mm'

  Wt_g:
    description: Weight measurement (calculated). NA if not recorded.
    any_of:
      - range: float
      - range: NotRecorded
    unit:
      ucum_code: g
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Calculated weight - pivot to MeasurementOrFact

  Wt_g_recorded:
    description: Weight measurement (recorded). NA if not recorded.
    any_of:
      - range: float
      - range: NotRecorded
    unit:
      ucum_code: g
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Recorded weight - may differ from calculated weight, can be separate MeasurementOrFact

  cloud_cover_10th:
    description: Cloud cover percentage estimated to the nearest 10%.
    range: string
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Cloud cover becomes MeasurementOrFact linked to Station eventID
    comments:
      - Special values used for conditions that prevent observation (smog, night)
    examples:
      - value: "5"
        description: 5 tenths cloud cover
      - value: "8-9"
        description: 8 to 9 tenths range
      - value: "0.5"
        description: 0.5 tenths
      - value: "smog"
        description: Smog conditions
      - value: "smog/2"
        description: Smog with ?
      - value: "night"
        description: Nighttime (not observable)
      - value: "sunrise"
        description: Sunrise conditions

  cruise_id:
    description: Cruise identifier
    range: string
    pattern: "^\\d{4}(_\\d)?$"
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Cruise ID becomes MeasurementOrFact linked to parent cruise event
    comments:
      - "Appears to be in YYMM or YYMM_N format (year-month with optional cruise number). Pattern is based on this assumption."
    examples:
      - value: "2206"
        description: June 2022 cruise
      - value: "2306_2"
        description: June 2023, second cruise
      - value: "2410"
        description: October 2024 cruise

  datetime:
    description: Date for station visit
    range: datetime
    pattern: ^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}
    exact_mappings:
      - dwc:eventDate
    annotations:
      transformation_type: direct
      transformation_note: Direct mapping to eventDate
    comments:
      - Must be ISO-8601 formatted, like YYYY-mm-DDTHH:MM:SS TZ
      - datetime could be confusing with the LinkML range type, datetime

  depth:
    description: Depth measurement in feet.
    range: float
    pattern: "^\\d+(\\.\\d)?$"
    unit:
      ucum_code: "[ft_i]"
    close_mappings:
    - dwc:minimumDepthInMeters
    - dwc:maximumDepthInMeters
    annotations:
      transformation_type: duplicate
      transformation_note: Single depth value maps to both minimumDepthInMeters and maximumDepthInMeters after converting from feet to meters.
    comments:
      - pattern assumes positive number with an option to specify the tenths place.

  hobo_id:
    description: HOBO data logger identifier
    range: string
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: HOBO logger ID becomes MeasurementOrFact linked to Station eventID
    comments:
      - assuming this is a data logger

  lat_end:
    description: End latitude coordinate
    range: float
    minimum_value: -90
    maximum_value: 90
    unit:
      ucum_code: deg
    related_mappings:
      - dwc:footprintWKT
      - dwc:geodeticDatum
    annotations:
      transformation_type: construct_wkt
      transformation_note: End latitude used in footprintWKT LINESTRING construction for parent cruise events
      geodeticDatum: WGS84

  lat_start:
    description: Start latitude coordinate
    range: float
    minimum_value: -90
    maximum_value: 90
    unit:
      ucum_code: deg
    exact_mappings:
      - dwc:decimalLatitude
      - dwc:geodeticDatum
    annotations:
      transformation_type: direct
      transformation_note: Start latitude maps to decimalLatitude for Event; also used in footprintWKT
    geodeticDatum: WGS84

  lon_end:
    description: End longitude coordinate
    range: float
    minimum_value: -180
    maximum_value: 180
    unit:
      ucum_code: deg
    related_mappings:
      - dwc:footprintWKT
      - dwc:geodeticDatum
    annotations:
      transformation_type: construct_wkt
      transformation_note: End longitude used in footprintWKT LINESTRING construction for parent cruise events
    geodeticDatum: WGS84

  lon_start:
    description: Start longitude coordinate
    range: float
    minimum_value: -180
    maximum_value: 180
    unit:
      ucum_code: deg
    exact_mappings:
      - dwc:decimalLongitude
      - dwc:geodeticDatum
    annotations:
      transformation_type: direct
      transformation_note: Start longitude maps to decimalLongitude for Event; also used in footprintWKT
    geodeticDatum: WGS84

  notes:
    description: Notes or remarks
    range: string
    close_mappings:
    - dwc:eventRemarks
    - dwc:occurrenceRemarks
    annotations:
      transformation_type: context_dependent
      transformation_note: Maps to eventRemarks in Station/Event context, occurrenceRemarks in CPUE/Occurrence context
    alias:
      - Notes

  old_station:
    description: >-
        Legacy station identifier. Multiple naming conventions used:
        - MOB turbine sites (discontinued after 2022-08-03)
        - Early USWind convention with underscores (2022-08-15 to 2022-09-01)
        - USWind convention with hyphens (2022-09-01 to 2024)
        Note: Underscores avoided after 2022-09-01 due to GPS compatibility
    range: string
    pattern: "^(C\\d{4}[-_]\\d(-\\d)?|[A-Z]\\d{1,2}|A-\\d-\\d)$"
    examples:
          - value: C2206_1
            description: Early format with underscore
          - value: A-7-6
            description: A-series format
    comments:
      - "MOB-developed naming convention for turbine sites; not reported after 2022-08-03 cruise"	
      - "A/B/C - buildout zone"
      - "first number: column from east to west"
      - "second number: row from north to south"
      - "Changed on 2022-08-15 after learning of USWind convention"
      - "Changed in 2024 season after new USW convention"
      - "Switched from using underscores to dashes after 2022-09-01, as the GPS does not read underscores"
    alias:
      - Old_Station

  participants:
    description: Participants. Crew members present during sampling (comma-separated).
    range: participantEnum
    multivalued: true
    exact_mappings:
    - dwc:recordedBy
    annotations:
      transformation_type: direct
      transformation_note: Participant initials map to recordedBy
    comments:
      - inclusion of 'multivalued' alllows for the comma separation

  ropeless_id:
    description: Ropeless gear identifier
    range: string
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Ropeless gear ID becomes MeasurementOrFact linked to Station eventID
    comments: 
      - unsure what possible values might exist

  scale_tare_g:
    description: Tare weight for scale
    range: integer
    unit:
      ucum_code: g
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Tare weight for scale - can be MeasurementOrFact or omitted
    comments: 
      - "Switch from spring scale to self-taring scale from 2308 cruise on"

  station:
    alias:
      - Station
    description: >-
      Station identifier for ocean sampling locations. Format evolved over time:
      - Pre-2024: Cruise-based (C####-#), grid coordinates, or A-series
      - 2024+: USWind convention (U[Letter]-##)
    range: string
    pattern: "^(U[A-Z]-\\d{2}|C\\d{4}[-_]\\d(-\\d)?|[A-Z]\\d{1,2}|A-\\d-\\d)$"
    examples:
      - value: UM-15
        description: Current USWind format (2024+)
      - value: C2411-2
        description: Cruise format from 2024 season
      - value: L12
        description: Grid coordinate format
    comments:
      - "MOB-developed naming convention for turbine sites; not reported after 2022-08-03 cruise"	
      - "A/B/C - buildout zone"
      - "first number: column from east to west"
      - "second number: row from north to south"
      - "Changed on 2022-08-15 after learning of USWind convention"
      - "Changed in 2024 season after new USW convention"
      - "Switched from using underscores to dashes after 2022-09-01, as the GPS does not read underscores"
    exact_mappings:
    - dwc:eventID
    - dwc:locationID
    annotations:
      transformation_type: direct
      transformation_note: Station identifier becomes both eventID and locationID

  surf_temp_f:
    description: Surface temperature in Fahrenheit
    range: float
    pattern: "^(2[6-9]|[3-9]\\d|1\\d{2})(\\.\\d+)?$"
    minimum_value: 30
    maximum_value: 110
    unit:
      ucum_code: "[degF]"
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Surface temperature becomes MeasurementOrFact linked to Station eventID
    comments:
      - pattern assumes number between 30 - 110 with an option to specify the tenths place.

  type:
    description: Event type (deploy or recover)
    range: DeploymentType
    exact_mappings:
    - dwc:eventType
    annotations:
      transformation_type: direct
      transformation_note: Type maps directly to eventType

  wave_height:
    description: Estimated wave height in feet, measured from trough to crest.
    range: string
    unit:
      ucum_code: "[ft_i]"
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Wave height becomes MeasurementOrFact linked to Station eventID
    examples:
      - value: "flat"
        description: Flat/calm conditions
      - value: "<2"
        description: Less than 2
      - value: "1-2"
        description: 1 to 2 range
      - value: "5.5"
        description: 5.5
      - value: "3"
        description: 3

  wind_dir:
    description: Wind direction
    range: CardinalDirection
    related_mappings:
    - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Wind direction becomes MeasurementOrFact linked to Station eventID

  wind_speed:
    description: Estimated wind speed in knots.
    range: string
    pattern: "^(<\\d+|\\d+-\\d+|\\d+\\+?)$"
    unit:
      ucum_code: "[kn_i]"
    related_mappings:
      - dwc:measurementValue
    annotations:
      transformation_type: pivot_to_mof
      transformation_note: Wind speed becomes MeasurementOrFact linked to Station eventID
    examples:
      - value: "<5"
        description: Less than 5
      - value: "10-15"
        description: 10 to 15 range
      - value: "10+"
        description: Greater than 10
      - value: "12"
        description: Exactly 12
    comments:
      - pattern allows values expressed as 'less than', a dashed 'range', or greater than, expressed with a '+'. See examples.

